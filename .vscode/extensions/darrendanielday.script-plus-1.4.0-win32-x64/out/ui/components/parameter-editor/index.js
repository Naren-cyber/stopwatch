import{Box as p,colors as I,FormControl as d,IconButton as j,MenuItem as G,Select as H,TextField as N,Input as w,InputLabel as C,Tooltip as T,FormLabel as J,Fab as Q,useTheme as U,makeStyles as X}from"../../_snowpack/pkg/@material-ui/core.js";import{AddOutlined as A,DeleteOutlined as D,Save as Y}from"../../_snowpack/pkg/@material-ui/icons.js";import h from"../../_snowpack/pkg/classnames.js";import*as y from"../../_snowpack/pkg/ramda.js";import e,{useEffect as B,useState as g}from"../../_snowpack/pkg/react.js";import{enumKeys as x,enumValues as S}from"../../_snowpack/pkg/taio/build/utils/enum.js";import{die as Z}from"../../_snowpack/pkg/taio/build/utils/internal/exceptions.js";import{isNumber as ee,isString as L}from"../../_snowpack/pkg/taio/build/utils/validator/primitive.js";import{assertNonNullish as te}from"../../utils/well-typed.js";import P from"../common/common.module.css.proxy.js";import{EnumPicker as ne}from"../enum-picker/index.js";import{ListPicker as R}from"../list-picker/index.js";import ae from"./style.module.css.proxy.js";import{useStyles as F}from"../common/common-mui-styles.js";import{useTypedIntl as K}from"../../i18n/core/locale.js";const le=X(a=>({saveFab:{position:"absolute",right:a.spacing(2),top:a.spacing(2)}}));export const ParameterEditor=({configObject:a,description:t,onDone:o})=>{const s=U(),r=F(),n=K(),l=le(),[u,E]=g(a),f=Object.keys(u),[b,v]=g(""),[c,O]=g(""),[m,k]=g(null);B(()=>{E(a)},[a]),B(()=>{v(t)},[t]);const _=m!==null?u[m]??null:null,V=c in u?n("components.parameterEditor.validate.exist",{newFieldName:c}):"",W=(i,z)=>E($=>({...$,[i]:z})),q=()=>{!c||(E(i=>({...i,[c]:{type:"string",defaultValue:"",description:"",enumOptions:void 0}})),O(""),k(c))};return e.createElement(p,null,e.createElement(Q,{color:"primary",onClick:()=>o?.(u,b),className:l.saveFab},e.createElement(Y,null)),e.createElement(p,null,e.createElement(N,{multiline:!0,rowsMax:3,style:{width:s.spacing(72)},variant:"outlined",label:n("components.parameterEditor.description.label"),placeholder:n("components.parameterEditor.description.placeholder"),value:b,onChange:i=>v(i.target.value)})),e.createElement(p,{className:h(P["center-row"],ae["config-name-edit-row"])},e.createElement(d,{className:r.formControl},e.createElement(J,null,n("components.parameterEditor.configKey.label"))),e.createElement(N,{variant:"outlined",value:c,onChange:i=>O(i.target.value),error:!!V,label:n("components.parameterEditor.configKey.new.label"),placeholder:n("components.parameterEditor.configKey.new.placeholder"),helperText:V}),e.createElement(j,{onClick:q,disabled:!!V||!c,color:"primary"},e.createElement(A,null))),e.createElement(p,null,!!f.length&&e.createElement(d,{className:h(r.formControl,r.selectControl)},e.createElement(C,null,n("components.parameterEditor.fieldEditor.picker.label")),e.createElement(R,{list:Object.keys(u),displayMapping:y.identity,value:m??"",onChange:i=>k(i)})),m!=null&&!!f.length&&e.createElement(d,{className:r.formControl},e.createElement(j,{style:{color:I.red[500]},onClick:()=>{te(m),E(i=>y.omit([m],i)),k(null)}},e.createElement(D,null)))),e.createElement(p,null,m!=null&&_!=null&&e.createElement(FieldEditor,{name:m,field:_,onFieldEdit:W})))};export var ConfigTypeEnum;(function(a){a.String="string",a.Number="number",a.Boolean="boolean",a.Enum="enum"})(ConfigTypeEnum||(ConfigTypeEnum={}));export const FieldEditor=({name:a,field:t,onFieldEdit:o})=>{const s=K(),r=F();return e.createElement(p,null,e.createElement(p,null,e.createElement(d,{className:h(r.formControl,r.selectControl)},e.createElement(C,null,s("components.parameterEditor.fieldEditor.type.label")),e.createElement(ne,{value:t.type,enumObject:ConfigTypeEnum,onChange:n=>{let l={...t};switch(l.type=n,n){case"enum":l.enumOptions={enumObject:{},enumNameMapping:{}};break;case"boolean":l.defaultValue=!1;break;case"number":l.defaultValue=0;break;case"string":l.defaultValue="";break;default:Z()}o?.(a,l)}})),e.createElement(d,{className:h(r.tinyFormControl)},e.createElement(C,null,s("components.parameterEditor.fieldEditor.defaultValue.label")),t.type==="number"?e.createElement(w,{type:"number",value:t.defaultValue,onChange:n=>o?.(a,{...t,defaultValue:+n.target.value})}):t.type==="string"?e.createElement(w,{value:t.defaultValue,onChange:n=>o?.(a,{...t,defaultValue:n.target.value})}):t.type==="boolean"?e.createElement(R,{list:[!1,!0],displayMapping:String,value:t.defaultValue,onChange:n=>o?.(a,{...t,defaultValue:n})}):e.createElement(H,{value:t.defaultValue,onChange:n=>o?.(a,{...t,defaultValue:n.target.value})},x(t.enumOptions.enumObject).map((n,l)=>e.createElement(G,{key:l,value:t.enumOptions.enumObject[n]},t.enumOptions.enumNameMapping?.[t.enumOptions.enumObject[n]]??n,"(",oe(t.enumOptions.enumObject[n]),")")))),t.type==="enum"&&e.createElement(d,{className:r.formControl},e.createElement(T,{title:s("components.parameterEditor.fieldEditor.enum.delete.tooltip")},e.createElement(j,{style:{color:I.red[500]},onClick:()=>{const n=y.omit([ee(t.defaultValue)?t.defaultValue+"":void 0,x(t.enumOptions.enumObject).find(l=>t.defaultValue===t.enumOptions.enumObject[l])].filter(L),t.enumOptions.enumObject);return o?.(a,{...t,defaultValue:S(n).find(y.T)??"",enumOptions:{enumObject:n,enumNameMapping:y.omit([S(t.enumOptions.enumObject).find(y.equals(t.defaultValue))?.toString()].filter(L),t.enumOptions.enumNameMapping??{})}})}},e.createElement(D,null))))),e.createElement(p,null,t.type==="enum"&&e.createElement(EnumValueEditor,{enumObject:t.enumOptions.enumObject,onAdd:(n,l,u)=>{o?.(a,{...t,enumOptions:{enumNameMapping:{...t.enumOptions.enumNameMapping,[l]:u||n},enumObject:Object.assign({...t.enumOptions.enumObject},M(l)?{[l.toString()]:n,[n]:l}:{[n]:l})}})}})),e.createElement(d,{className:h(r.formControl,r.textAreaControl)},e.createElement(C,null,s("components.parameterEditor.fieldEditor.description.label")),e.createElement(w,{placeholder:s("components.parameterEditor.fieldEditor.description.placeholder"),value:t.description,multiline:!0,rows:2,onChange:n=>o?.(a,{...t,description:n.target.value})})))},EnumValueEditor=({onAdd:a,enumObject:t})=>{const o=K(),s=F(),[r,n]=g(""),[l,u]=g(""),[E,f]=g(""),b=x(t??{}).includes(r)?o("components.parameterEditor.fieldEditor.enum.valueEditor.validate.name.exists",{enumKey:r}):/^[a-z]/i.test(r)?"":o("components.parameterEditor.fieldEditor.enum.valueEditor.validate.name.startWithWords"),v=S(t??{}).includes(l)?o("components.parameterEditor.fieldEditor.enum.valueEditor.validate.value.exists",{enumValue:l.toString()}):l===""?o("components.parameterEditor.fieldEditor.enum.valueEditor.validate.value.notEmpty"):"",c=!v&&!b,O=()=>e.createElement(j,{color:"primary",disabled:!c,onClick:()=>{a?.(r,l,E),n(""),u(""),f("")}},e.createElement(A,null));return e.createElement(p,{className:P["center-row"]},e.createElement(N,{variant:"outlined",className:s.tinyFormControl,label:o("components.parameterEditor.fieldEditor.enum.valueEditor.name.label"),error:!!b,helperText:b,value:r,onChange:m=>n(m.target.value)}),e.createElement(N,{variant:"outlined",className:s.tinyFormControl,label:o("components.parameterEditor.fieldEditor.enum.valueEditor.value.label"),error:!!v,helperText:v,value:l,onChange:m=>u(M(m.target.value)?+m.target.value:m.target.value+"")}),e.createElement(N,{variant:"outlined",className:s.tinyFormControl,label:o("components.parameterEditor.fieldEditor.enum.valueEditor.display.label"),value:E,onChange:m=>f(m.target.value)}),e.createElement(d,null,c?e.createElement(T,{title:o("components.parameterEditor.fieldEditor.enum.valueEditor.add.tooltip")},O()):O()))};const M=a=>!isNaN(+a)&&a!=="",oe=a=>M(a)?+a+"":`"${a}"`;
