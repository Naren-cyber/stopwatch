import{Box as P,FormGroup as w,FormControl as S,FormLabel as y,TextField as C,IconButton as c,InputLabel as _,colors as u,Tooltip as f,Dialog as h,DialogTitle as b,DialogContent as j,DialogActions as A,Typography as M,Divider as I}from"../../_snowpack/pkg/@material-ui/core.js";import{Autorenew as O,Check as F,Close as T,DeleteOutlined as N,LaunchOutlined as W,SaveOutlined as B}from"../../_snowpack/pkg/@material-ui/icons.js";import*as G from"../../_snowpack/pkg/ramda.js";import e,{useEffect as x,useState as E}from"../../_snowpack/pkg/react.js";import{noop as R}from"../../_snowpack/pkg/taio/build/utils/typed-function.js";import{usePromote as D}from"../../hooks/use-promote.js";import{useTypedIntl as v}from"../../i18n/core/locale.js";import{useStyles as V}from"../common/common-mui-styles.js";import{ListPicker as d}from"../list-picker/index.js";const q=({open:l,onSave:a,onCancel:i})=>{const[o,m]=E(""),n=v();return e.createElement(h,{open:l,onClose:i},e.createElement(b,null,n("runner.preset.save.title")),e.createElement(j,null,e.createElement(w,null,e.createElement(S,null,e.createElement(y,null,n("runner.preset.save.name")),e.createElement(C,{value:o,onChange:r=>m(r.target.value),helperText:n("runner.preset.save.help")})))),e.createElement(A,null,e.createElement(c,{color:"primary",onClick:i},e.createElement(T,null)),e.createElement(c,{color:"primary",onClick:()=>{a({name:o})}},e.createElement(F,null))))},z=["Global","Workspace","WorkspaceFolder"],H=({open:l,onSave:a,onCancel:i})=>{const[o,m]=E(""),[n,r]=E("Workspace"),s=v();return e.createElement(h,{open:l,onClose:i},e.createElement(b,null,s("runner.preset.auto.title")),e.createElement(j,null,e.createElement(M,null,s("runner.preset.auto.description")),e.createElement(I,null),e.createElement(w,null,e.createElement(C,{label:s("runner.preset.auto.name.label"),value:o,variant:"outlined",onChange:p=>m(p.target.value),helperText:s("runner.preset.auto.name.hint")}),e.createElement(I,null),e.createElement(S,null,e.createElement(y,null,s("runner.preset.auto.scope")),e.createElement(d,{value:n,onChange:r,displayMapping:G.identity,list:z})))),e.createElement(A,null,e.createElement(c,{color:"primary",onClick:i},e.createElement(T,null)),e.createElement(c,{color:"primary",onClick:()=>{a({scope:n,parameter:o||!1})}},e.createElement(F,null))))};export const PresetTools=({script:l,currentArguments:a,onLoadPreset:i})=>{const o=V(),m=v(),n=l.presetArgs??[],[r,s]=E();x(()=>{s(t=>l.presetArgs?.find(k=>k.name===t?.name))},[l]),x(()=>{r&&i(r)},[r]);const p=D(q),g=D(H);return e.createElement(P,null,p.view,g.view,!!n.length&&e.createElement(S,{className:o.selectControl},e.createElement(_,null,m("runner.preset.label")),e.createElement(d,{list:n,displayMapping:t=>t.name,identity:d.key("name"),value:r,onChange:s})),!!r&&e.createElement(e.Fragment,null,e.createElement(c,{style:{color:u.amber[400]},onClick:()=>window.SessionInvoker.ScriptService.updateScript({...l,presetArgs:n.map(t=>t.name===r.name?{...t,args:a}:t)})},e.createElement(B,null)),e.createElement(c,{style:{color:u.red[500]},onClick:()=>window.SessionInvoker.ScriptService.updateScript({...l,presetArgs:n.filter(t=>t.name!==r.name)})},e.createElement(N,null))),!!Object.keys(a).length&&e.createElement(f,{title:m("runner.preset.save.as")},e.createElement(c,{style:{color:u.blue[500]},onClick:()=>p.askForSave().then(({name:t})=>{window.SessionInvoker.ScriptService.updateScript({...l,presetArgs:[...n,{name:t,args:a}]})}).catch(R)},e.createElement(W,null))),e.createElement(f,{title:m("runner.preset.auto.title")},e.createElement(c,{style:{color:u.blue[500]},onClick:async()=>{const{parameter:t,scope:k}=await g.askForSave();t&&await window.SessionInvoker.ScriptService.updateScript({...l,presetArgs:[...n,{name:t,args:a}]});const L=await window.SessionInvoker.ScriptService.getAutoList();await window.SessionInvoker.ScriptService.updateAutoScripts([...L,{parameter:t||a,script:l.name}],k)}},e.createElement(O,null))))};
